---
title: "Introduction to tablestylizer"
author: "Ville Lang√©n"
date: "`r Sys.Date()`"
#output: rmarkdown::html_vignette
output:
  rmarkdown::html_vignette:
    fig_caption: false
    toc: true
    toc_depth: 1
    df_print: default

vignette: >
  %\VignetteIndexEntry{Introduction to tablestylizer}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

```

```{r setup, echo=FALSE, message=FALSE}
library(tablestylizer)
library(tableone)
library(tibble)
library(dplyr)
library(flextable)
```


<br/><br/>

# 1. Overview {#overview}

**tablestylizer** provides a set of functions designed to enhance the styling and formatting of tables in R. This package is particularly useful for making tables suitable for publication or presentation. The main functionalities of **tablestylizer** can be summarized through the following four functions:

- `stylize_tableone()`: This function processes a tableone object (that has been generated by the CreateTableOne function of the [tableone](https://cran.r-project.org/web/packages/tableone/vignettes/introduction.html) package) and performs various operations to make the output more suitable for publication.

- `stylize_p()`: Rounds and formats numeric values for improved readability, designed for presenting p-values in statistical outputs.

- `stylize1()`: Stylizes numeric values with highly custom rules aiming for 1 decimal place.

- `stylize2()`: Stylizes numeric values with highly custom rules aiming for 2 decimal places.

<br/>
<br/>

# 2. Quick showcase

I demonstrate here the unparalleled ease and efficiency of creating publication-ready tables using the **tableone**, **flextable**, and **tablestylizer** packages. With just a few simple commands, users can transform raw data into visually appealing and professionally formatted tables suitable for academic journals and alike.


```{r, ft.align="left"}
# Load the example dataset
data("tablestylizer_df", package = "tablestylizer")

## Vectors for 1) all, 2) categorical variables 
myVars <- c("Age", "Sex", "Height", "Likes.coffee", "Favorite.color")
catVars <- c("Sex", "Likes.coffee", "Favorite.color")

## Create and store a tableone object
my_df <- CreateTableOne(vars = myVars, data = tablestylizer_df, factorVars = catVars)

# Process the tableone object with stylize_tableone()
my_df <- stylize_tableone(my_df)

# Stylize variables as desired
my_df[2:6,1] <- c("Age (years)","Women", "Height (inches)", "Likes coffee", "Favorite color")
my_df <- my_df %>% rename(Value = Overall)

# Create a flextable object
ft <- my_df %>% flextable() %>% width(width = 2.5) %>%
                  align(j = 2, align = "center", part = "all") %>% 
                  bold(part = "header", bold = TRUE) %>% 
                  add_header_lines("Table 1. Characteristics of the (imaginary) study participants.") %>% 
                  add_footer_lines(("Values are means (and standard deviations) for continuous data and numbers (and percentages) for categorical data.")) %>%
                  prepend_chunks(i = 7:9, j = 1, as_chunk("\t"))

# Display the ready table
ft                                
```


<br/>
<br/>


# 3. Motivations and limitations

## 3.1 Motivation

Motivations for this package include, but are not limited to, the following examples:

1. While the [tableone](https://cran.r-project.org/web/packages/tableone/vignettes/introduction.html) package is an invaluable tool for generating nearly publication-ready tables of characteristics, some additional tidying up is often required before submission to a journal.

2. Additionally, many of the functions in tablestylizer are not limited to "Characteristics" tables but can be applied to any tables that require tasks such as rounding, offering a comprehensive set of tools for users working with tabular data in R.

## 3.2 Limitations

Despite its versatility, the **tablestylizer** package comes with certain limitations:

1. **Rounding Methodology:** The rounding method used in this package follows deliberately the traditional arithmetic rounding, where numbers ending in .5 always round upwards. I call this "high school rounding" reminiscent of the rounding method most of us learn in school. This approach, similar to what many popular programs like Excel employ, contrasts with Base R, which uses [banker's rounding](https://wiki.c2.com/?BankersRounding).

2. **stylize_tableone() Function:** At present, the `stylize_tableone()` function is designed to produce means ¬± SDs and numbers (percentages) statistics. It does not provide medians (IQRs). If the capability to generate medians (IQRs) is a desired feature, it may be considered for implementation in future updates of the package.


<br/><br/>


# 4. Example datasets for practicing

To facilitate the exploration and application of the `stylize_tableone()` function, the **tablestylizer** package includes several example datasets.

<br/>

Here's a breakdown of all example datasets in the **tablestylizer** package: 

| Dataset name     | Format               | Description                                                                    |
| :--------------- | :------------------- | :----------------------------------------------------------------------------- |
| tablestylizer_df| tibble                | Example Dataset with Imaginary Demographic Data|
| tableone_1g     | tableone object (list)| Example tableone Object where data are presented in only one column ("Overall")|
| tableone_3g     |tableone object (list) | Example tableone Object where data are presented separately for subgroups|
| rtableone_3g_p  | tableone object (list)| Same as the tableone_3g, but including    between-group comparison test|

<br/>

Let's skim through the first example dataset.

```{r, echo=TRUE}
# Load the example dataset
data("tablestylizer_df", package = "tablestylizer")

# Display the head of the dataset
head(tablestylizer_df)
```

<br/>

The data presented above can easily be converted into a tableone object by running a code that uses the function `CreateTableOne` from the **tableone** package.

```{r, echo=TRUE}
## Get variables names
dput(names(tablestylizer_df))

## Vector of all variables that shall be summarized by CreateTableOne 
myVars <- c("Age", "Sex", "Height", "Likes.coffee", "Favorite.color", "Group")

## Vector of categorical variables
catVars <- c("Sex", "Likes.coffee", "Favorite.color", "Group")

## Create and display tableone object
CreateTableOne(vars = myVars, data = tablestylizer_df, factorVars = catVars)
```

<br/>

For the sake of further practice sessions, the above tableone object is available as an example dataset object called `tableone_1g` in the **tablestylizer** package.



<br/><br/>


# 5. Tidying up tableone objects: stylize_tableone()

The `stylize_tableone()` function in the **tablestylizer** package is designed to enhance the presentation of tableone objects, making them more suitable for publication or presentation.

Here's a list of what `stylize_tableone()` does:

- **Moving Percentages:** The [tableone](https://cran.r-project.org/web/packages/tableone/vignettes/introduction.html) package includes annotations such as "(%)" for percentages in the variable column. However, these heavy annotations are not commonly found in published manuscripts. `stylize_tableone()` addresses this by moving percentage annotations rightwards to the corresponding statistics columns.

- **Handling Means and SDs:** Annotations like "(mean (SD))" for means with standard deviations are also repositioned rightwards and formatted as "ùë• ¬± ùë¶". This modification aligns with the typical presentation style in many published works, improving the overall readability of the table.



- **P-value Formatting:** The default behavior of the `tableone` package expresses p-values with 3 digits. However, in many published works, p-values are commonly presented with 2 digits for brevity and clarity. The `stylize_tableone()` function aligns with this convention, expressing p-values with 2 digits whenever possible, providing a more standardized and visually appealing format.

## 5.1 One column of data

Let's look at the example dataset `tableone_1g` of the **tablestylizer** package. `tableone_1g` is already in tableone object format and thus ready to be modified by the function `stylize_tableone()`.

```{r, echo=TRUE}
# Load the example dataset
data("tableone_1g", package = "tablestylizer")

# Display "tableone_1g" object
tableone_1g
```

<br/>

This tableone object can now be processed by `stylize_tableone()`. 

```{r, echo=TRUE}
# Process the tableone object, pipe it to print() command to align left
stylize_tableone(tableone_1g) %>% print(right = FALSE)

```

<br/>

Pay always attention that the levels of the binary categorical variables come out as is desired. Here, the variable `Sex` needs adjustment.


```{r, echo=TRUE}

# Process the tableone object, store it to "table_1"
table_1 <- stylize_tableone(tableone_1g)

# Recode the text for the variable "sex"
table_1[3,1] <- "Women"

# Print the ready "table_1" (align left)
print(table_1, right = FALSE)

```

<br/>


## 5.1.1 Recoding of binary variables

If the levels of the binary categorical factor variable need to be reversed, that can be accomplished easily. Base R can be used for this, but the easiest solution is to use the **forcats** package for this. 

As an example, let's change `Likes.coffee` to `Dislikes.coffee`. There are a zillion different ways to accomplish this, but an easy solution is to change the order of the factor variable.

Let's start by creating a new factor variable `Likes.coffee_2` that has the order of the factor levels reversed.

```{r, echo=TRUE}
# Load forcats
library(forcats)

# Load the example dataset
data("tablestylizer_df", package = "tablestylizer")

# Create a new factor variable with reversed levels
tablestylizer_df$Likes.coffee_2 <- fct_rev(tablestylizer_df$Likes.coffee)

# Display head
head(tablestylizer_df, n=5)

```

<br/>

When you look at the data frame above, nothing seems to have changed. However, when you create a new tableone object of those data, you can see that the order of the levels have been changed.


```{r}

## Vector of all variables that shall be summarized by CreateTableOne
myVars <- c("Likes.coffee", "Likes.coffee_2")

## Vector of categorical variables
catVars <- c("Likes.coffee", "Likes.coffee_2")

## Create and display tableone object
CreateTableOne(vars = myVars, data = tablestylizer_df, factorVars = catVars)

```

<br/>

Now, we know how to easily reproduce the same ready table as above but with a reversed `Likes.coffee` variable.


```{r}

# Load the example dataset
data("tablestylizer_df", package = "tablestylizer")

# Create a new factor variable with reversed levels
tablestylizer_df$Likes.coffee_2 <- fct_rev(tablestylizer_df$Likes.coffee)

## Vector of all variables that shall be summarized by CreateTableOne 
myVars <- c("Age", "Sex", "Height", "Likes.coffee_2", "Favorite.color", "Group")

## Vector of categorical variables
catVars <- c("Sex", "Likes.coffee_2", "Favorite.color", "Group")

## Create and store a tableone object
my_df <- CreateTableOne(vars = myVars, data = tablestylizer_df, factorVars = catVars)

# Display the tableone object
my_df

# Process the tableone object
my_df <- stylize_tableone(my_df)

# Rename binary variables as desired
my_df[3,1] <- "Women"
my_df[5,1] <- "Dislikes coffee"

# Display the processed tableone object, pipe it to print() command to align left
my_df %>% print(right = FALSE)

```


<br/>

## 5.2 Several columns of data

Let's examine the example dataset `tableone_3g` of the **tablestylizer** package. This dataset contains subgroup data, where information is presented across multiple columns. 


```{r, echo=TRUE}
# Load the example dataset
data("tableone_3g", package = "tablestylizer")

# Display "tableone_3g" object
tableone_3g
```

<br/>

The `stylize_tableone()` function effectively manages this type of tableone object.

```{r, echo=TRUE}
# Process the tableone object, pipe it to print() command to align left
stylize_tableone(tableone_3g) %>% print(right = FALSE)

```

<br/>


## 5.2 Between-group comparison

Now, let's explore the example dataset `tableone_3g_p` from the **tablestylizer** package. Similar to `tableone_3g`, this dataset contains subgroup data. However, `tableone_3g_p` includes additional between-group comparisons with p-values. The `stylize_tableone()` function seamlessly handles this type of tableone object. It's worth noting that `stylize_tableone()` processes the p-values using a dedicated function called `stylize_p()`, which is also part of the **tablestylizer** package.


```{r, echo=TRUE}
# Load the example dataset
data("tableone_3g_p", package = "tablestylizer")

# Display "tableone_3g_" object
tableone_3g_p
```

<br/>

This tableone object can now be processed by `stylize_tableone()`.

```{r, echo=TRUE}
# Process the tableone object, pipe it to print() command to align left
stylize_tableone(tableone_3g_p) %>% print(right = FALSE)

```




