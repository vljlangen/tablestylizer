---
title: "Introduction to tablestylizer"
author: "Ville Lang√©n"
date: "`r Sys.Date()`"
#output: rmarkdown::html_vignette
output:
  rmarkdown::html_vignette:
    fig_caption: false
    toc: true
    toc_depth: 1
    df_print: default

vignette: >
  %\VignetteIndexEntry{Introduction to tablestylizer}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo=FALSE}
library(tablestylizer)
library(tableone)
library(tibble)
library(flextable)
```


<br/><br/>

# 1. Overview {#overview}

**tablestylizer** provides a set of functions designed to enhance the styling and formatting of tables in R. This package is particularly useful for making tables suitable for publication or presentation. The main functionalities of **tablestylizer** can be summarized through the following four functions:

- `stylize_tableone()`: This function processes a tableone object, which is generated by the CreateTableOne function of the tableone package. It performs various operations to make the output more suitable for publication, including converting row names to column names, transferring percentage symbols, removing unnecessary symbols, and rounding p-values. It returns a data frame representing the processed tableone object.

- `stylize_p()`: Round and format numeric values for improved readability, especially when used for p-values in statistical outputs. It avoids outputting "0.05" intentionally, as this specific value may not hold significant meaning to the reader in typical situations where the significance level (alpha) is set at 0.05.

- `stylize1()`: Stylize numeric values with custom rules aiming for 1 decimal place. It rounds values to 1 decimal place unless they round to a smaller digit, and values less than 0.001 are expressed as "<0.001".

- `stylize2()`: Stylize numeric values with custom rules aiming for 2 decimal places. It rounds values to 2 decimal places unless they round to a smaller digit, and values less than 0.001 are expressed as "<0.001".


## 1.1 Motivation

While the `tableone` package is an invaluable tool for generating nearly publication-ready tables of characteristics, some tidying up is often required before the table is ready for submission to a journal. The `tablestylizer` package addresses this need by providing functions that enhance the presentation of tables and make them more polished and publication-ready. 

Additionally, some of these functions are not limited to characteristics tables but can be applied to any tables, offering a comprehensive set of tools for users working with tabular data in R.

## 1.2 Limitations

Despite its versatility, the **tablestylizer** package comes with certain limitations:

1. **Rounding Methodology:** The rounding method used in this package follows deliberately the traditional arithmetic rounding, where numbers ending in .5 always round upwards. I call this "high school rounding" reminiscent of the rounding method most of us learn in school. This approach, similar to what many popular programs like Excel employ, contrasts with Base R, which uses [banker's rounding](https://wiki.c2.com/?BankersRounding).

2. **stylize_tableone() Function:** At present, the `stylize_tableone()` function is designed to produce means ¬± SDs and numbers (percentages) statistics. It does not provide medians (IQRs). If the capability to generate medians (IQRs) is a desired feature, it may be considered for implementation in future updates of the package.


<br/><br/>


# 2. Example dataset for practicing

To facilitate the exploration and application of the `stylize_tableone()` function, the **tablestylizer** package includes an example dataset. This dataset comprises fictional demographic data for a group of individuals and serves as a practical resource for users to practice and experiment with the functionalities of the `tablestylizer` package.

Let's begin by loading the example dataset.

```{r, echo=TRUE}
# Load the example dataset
data("tablestylizer_df", package = "tablestylizer")

# Display the head of the dataset
head(tablestylizer_df)
```

Those data can now easily be converted into a tableone object by running a code that uses the function `CreateTableOne` from the **tableone** package.

```{r, echo=TRUE}
## Get variables names
dput(names(tablestylizer_df))

## Vector of all variables that shall be summarized by CreateTableOne 
myVars <- c("Age", "Sex", "Height", "Likes.coffee", "Favorite.color", "Group")

## Vector of categorical variables
catVars <- c("Sex", "Likes.coffee", "Favorite.color", "Group")

## Create and display tableone object
CreateTableOne(vars = myVars, data = tablestylizer_df, factorVars = catVars)
```

For further practice sessions, the above tableone object has already been created and stored as `tableone_1g` dataset in the **tablestylizer** package.

Here's a breakdown of all example datasets in the **tablestylizer** package: 

| Dataset name     | Format               | Description                                                                    |
| :--------------- | :------------------- | :----------------------------------------------------------------------------- |
| tablestylizer_df| tibble                | Example Dataset with Imaginary Demographic Data|
| tableone_1g     | tableone object (list)| Example tableone Object where data are presented in only one column ("Overall")|
| tableone_3g     |tableone object (list) | Example tableone Object where data are presented separately for subgroups|
| rtableone_3g_p  | tableone object (list)| Same as the tableone_3g, but including    between-group comparison test|



<br/><br/>


# 3. Tidying up tableone objects: stylize_tableone()

The `stylize_tableone()` function in the **tablestylizer** package is designed to enhance the presentation of tableone objects, making them more suitable for publication or presentation.

Here's a list of what `stylize_tableone()` does:

- **Moving Percentages:** The `tableone` package includes annotations such as "(%)" for percentages in the variable column. However, these heavy annotations are not commonly found in published manuscripts. `stylize_tableone()` addresses this by moving percentage annotations rightwards to the corresponding statistics columns.

- **Handling Means and SDs:** Annotations like "(mean (SD))" for means with standard deviations are also repositioned rightwards and formatted as "ùë• ¬± ùë¶". This modification aligns with the typical presentation style in many published works, improving the overall readability of the table.



- **P-value Formatting:** The default behavior of the `tableone` package expresses p-values with 3 digits. However, in many published works, p-values are commonly presented with 2 digits for brevity and clarity. The `stylize_tableone()` function aligns with this convention, expressing p-values with 2 digits whenever possible, providing a more standardized and visually appealing format.

## 3.1 Data presented in one column ("Overall")

Let's look at the example dataset `tableone_1g` of the **tablestylizer** package. `tableone_1g` is already in tableone object format and thus ready to be modified by the function `stylize_tableone()`.

```{r, echo=TRUE}
# Load the example dataset
data("tableone_1g", package = "tablestylizer")

# Display "tableone_1g" object
tableone_1g
```

This tableone object can now be processed `stylize_tableone()`.


```{r, echo=TRUE}
# Process the tableone object
stylize_tableone(tableone_1g) 
```




